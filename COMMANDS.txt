# BABYSHIELD BACKEND - DEPLOYMENT COMMANDS
# =========================================

# 1. BUILD THE DOCKER IMAGE
docker build -f Dockerfile.final -t babyshield-backend:complete .

# 2. LOGIN TO AWS ECR
aws ecr get-login-password --region eu-north-1 | docker login --username AWS --password-stdin 180703226577.dkr.ecr.eu-north-1.amazonaws.com

# 3. TAG THE IMAGE
docker tag babyshield-backend:complete 180703226577.dkr.ecr.eu-north-1.amazonaws.com/babyshield-backend:production-20250831

# 4. PUSH TO ECR
docker push 180703226577.dkr.ecr.eu-north-1.amazonaws.com/babyshield-backend:production-20250831

# 5. REGISTER ECS TASK (Run in AWS CloudShell)
aws ecs register-task-definition --family babyshield-backend-task --task-role-arn arn:aws:iam::180703226577:role/babyshield-task-role --execution-role-arn arn:aws:iam::180703226577:role/ecsTaskExecutionRole --network-mode awsvpc --requires-compatibilities FARGATE --cpu 1024 --memory 2048 --region eu-north-1 --container-definitions '[{"name":"babyshield-backend","image":"180703226577.dkr.ecr.eu-north-1.amazonaws.com/babyshield-backend:production-20250831","essential":true,"portMappings":[{"containerPort":8001,"protocol":"tcp"}],"environment":[{"name":"DATABASE_URL","value":"YOUR_DATABASE_URL"},{"name":"OPENAI_API_KEY","value":"YOUR_OPENAI_KEY"},{"name":"JWT_SECRET_KEY","value":"YOUR_JWT_SECRET"},{"name":"SECRET_KEY","value":"YOUR_SECRET_KEY"},{"name":"ENCRYPTION_KEY","value":"YOUR_ENCRYPTION_KEY"}]}]'
